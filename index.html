<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Drehbare W체rfel + Paarsummen</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2em;
      text-align: center;
    }

    .dice-row {
      display: flex;
      gap: 22px;
      justify-content: center;
      margin-bottom: 22px;
    }

    .scene {
      width: 64px;
      height: 64px;
      perspective: 700px;
    }

    .dice {
      width: 64px;
      height: 64px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 900ms cubic-bezier(.2,.7,.2,1);
      margin: 0 auto;
    }

    .face {
      position: absolute;
      width: 64px;
      height: 64px;
      background: #fff;
      border: 2px solid #222;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: inset 0 0 20px rgba(0,0,0,.06);
    }

    .front  { transform: rotateY(0deg)   translateZ(32px); }
    .back   { transform: rotateY(180deg) translateZ(32px); }
    .right  { transform: rotateY(90deg)  translateZ(32px); }
    .left   { transform: rotateY(-90deg) translateZ(32px); }
    .top    { transform: rotateX(90deg)  translateZ(32px); }
    .bottom { transform: rotateX(-90deg) translateZ(32px); }

    .is-fifth .face {
      background: #000;
      color: #fff;
      border: 2px solid #fff;
    }

    .pip {
      width: 10px;
      height: 10px;
      background: currentColor;
      border-radius: 50%;
      position: absolute;
    }

    /* Zentrierte Pip-Positionen */
    .p1 { top: 50%; left: 50%; transform: translate(-50%, -50%); }
    .p2 { top: 25%; left: 25%; transform: translate(-50%, -50%); }
    .p3 { top: 75%; left: 75%; transform: translate(-50%, -50%); }
    .p4 { top: 25%; left: 75%; transform: translate(-50%, -50%); }
    .p5 { top: 75%; left: 25%; transform: translate(-50%, -50%); }
    .p6 { top: 50%; left: 25%; transform: translate(-50%, -50%); }
    .p7 { top: 50%; left: 75%; transform: translate(-50%, -50%); }

    button {
      margin-top: 10px;
      padding: 10px 18px;
      font-size: 16px;
      cursor: pointer;
    }

    #values {
      margin-top: 12px;
      font-weight: 600;
    }

    #result {
      margin-top: 24px;
      text-align: left;
      display: inline-block;
    }

    .pasch {
      color: #d00;
      font-weight: 800;
    }

    #list2 {
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      transition: opacity 0.6s ease, max-height 0.6s ease;
    }

    #list2.show {
      opacity: 1;
      max-height: 1000px;
    }
  </style>
</head>
<body>
  <div class="dice-row" onclick="rollAndCalc()">
    <div class="scene"><div class="dice" id="d1"></div></div>
    <div class="scene"><div class="dice" id="d2"></div></div>
    <div class="scene"><div class="dice" id="d3"></div></div>
    <div class="scene"><div class="dice" id="d4"></div></div>
    <div class="scene"><div class="dice is-fifth" id="dice5"></div></div>
  </div>

  <label>
    <input type="checkbox" id="toggleFifth" checked />
    Kombinationen des 5. W체rfel ausblenden
  </label>

  <div id="values" style="display:none;"></div>
  <div id="result">
    <div id="list1"></div>
    <div id="list2"></div>
  </div>

  <script>
    let lastValues = [];
    let lastSplits5unique = [];

    function createDice(id) {
      const dice = document.getElementById(id);
      const faces = ['front','back','right','left','top','bottom'];
      const pipsMap = {
        1: [['p1']],
        2: [['p2'], ['p3']],
        3: [['p2'], ['p1'], ['p3']],
        4: [['p2'], ['p4'], ['p5'], ['p3']],
        5: [['p2'], ['p4'], ['p1'], ['p5'], ['p3']],
        6: [['p2'], ['p4'], ['p5'], ['p3'], ['p6'], ['p7']]
      };

      for (let i = 0; i < 6; i++) {
        const value = i + 1;
        const div = document.createElement('div');
        div.className = "face " + faces[i];

        pipsMap[value].forEach(clsArr => {
          const pip = document.createElement('div');
          pip.className = 'pip ' + clsArr.join(' ');
          div.appendChild(pip);
        });

        dice.appendChild(div);
      }
      dice.style.transform = "rotateX(0deg) rotateY(0deg) rotateZ(0deg)";
    }

    ['d1','d2','d3','d4','dice5'].forEach(createDice);

    function orientationForFrontValue(v) {
      switch (v) {
        case 1: return { x: 0,   y: 0,   z: 0   };
        case 2: return { x: 0,   y: 180, z: 0   };
        case 3: return { x: 0,   y: -90, z: 0   };
        case 4: return { x: 0,   y: 90,  z: 0   };
        case 5: return { x: -90, y: 0,   z: 0   };
        case 6: return { x: 90,  y: 0,   z: 0   };
        default: return { x: 0, y: 0, z: 0 };
      }
    }

    function extraSpins() {
      const r = () => 360 * Math.floor(Math.random()*3);
      return { x: r(), y: r(), z: r() };
    }

    function animateDiceToValue(id, value) {
      const el = document.getElementById(id);
      const base = orientationForFrontValue(value);
      const add  = extraSpins();
      el.style.transform = `rotateX(${base.x + add.x}deg) rotateY(${base.y + add.y}deg) rotateZ(${base.z + add.z}deg)`;
    }

    function rollValues(n) {
      return Array.from({length: n}, () => 1 + Math.floor(Math.random()*6));
    }

    function getSplits(arr) {
      const n = arr.length, out = [], seen = new Set();
      for (let i = 0; i < n; i++) {
        for (let j = i + 1; j < n; j++) {
          for (let k = 0; k < n; k++) {
            if (k === i || k === j) continue;
            for (let l = k + 1; l < n; l++) {
              if (l === i || l === j) continue;
              const pair1 = [arr[i], arr[j]], pair2 = [arr[k], arr[l]];
              const p1k = [...pair1].sort((a,b)=>a-b).join('-');
              const p2k = [...pair2].sort((a,b)=>a-b).join('-');
              const key = [p1k, p2k].sort().join('|');
              if (!seen.has(key)) {
                seen.add(key);
                out.push({ pair1, pair2, key, idx: { pair1:[i,j], pair2:[k,l] } });
              }
            }
          }
        }
      }
      return out;
    }

    function formatSplits(splits) {
      let text = '';
      splits.forEach(s => {
        const sum1 = s.pair1[0] + s.pair1[1];
        const sum2 = s.pair2[0] + s.pair2[1];
        let p1 = `(${s.pair1[0]},${s.pair1[1]})`;
        let p2 = `(${s.pair2[0]},${s.pair2[1]})`;
        if (s.pair1[0] === s.pair1[1]) p1 = `<span class="pasch">${p1}</span>`;
        if (s.pair2[0] === s.pair2[1]) p2 = `<span class="pasch">${p2}</span>`;
        text += `${p1} & ${p2}: ${sum1}, ${sum2}\n`;
      });
      return text;
    }

    function updateFifthDisplay() {
      const list2 = document.getElementById("list2");
      const showFifth = !document.getElementById("toggleFifth").checked;

      if (showFifth && lastSplits5unique.length > 0) {
        list2.innerHTML =
          "<b>Liste 2 (zus채tzlich durch W체rfel 5):</b>\n" + formatSplits(lastSplits5unique);
        list2.classList.add("show");
      } else {
        list2.classList.remove("show");
        list2.innerHTML = "";
      }
    }

    document.getElementById("toggleFifth").addEventListener("change", updateFifthDisplay);
  </script>
</body>
</html>
